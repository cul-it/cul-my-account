= javascript_include_tag 'application'
= javascript_include_tag 'my_account/account'

- request_types = {'H' => 'Hold', 'R' => 'Recall', 'illiad' => 'Interlibrary Loan', 'bd' => 'Borrow Direct'}
%h3 
  Account information for 
  = "#{@patron['first_name']} #{@patron['last_name']}"

%ul.nav.nav-tabs{:role => "tablist"}
  %li.active{:role => "presentation"}
    = link_to "Checked out (#{@checkouts.count})", "#checkouts", :class => "nav-link active", :data => { :toggle => "tab" }, :role => "tab", :aria => { :controls => "checkouts" }
  %li{:role => "presentation"}
    = link_to "Ready for pickup (#{@available_requests.count})", "#available-requests", :class => "nav-link active", :data => { :toggle => "tab" }, :role => "tab", :aria => { :controls => "available requests" }
  %li{:role => "presentation"}
    = link_to "Pending requests (#{@pending_requests.count})", "#pending-requests", :class => "nav-link active", :data => { :toggle => "tab" }, :role => "tab", :aria => { :controls => "pending requests" }
  %li{:role => "presentation"}
    = link_to "Fines and fees (#{@fines.count})", "#fines", :class => "nav-link active", :data => { :toggle => "tab" }, :role => "tab", :aria => { :controls => "fines and fees" }

%div.tab-content
  %div#checkouts.tab-pane.fade.in.active{:role => "tabpanel"}
    %table#checkouts-table
      %tbody
        %tr
          %th{:style => "width: 5%"}
            = check_box_tag 'select-all-checkouts', 1, nil, { :id => '', :class => 'select-all' }
          %th{:style => "width: 10%"} Due date
          %th{:style => "width: 50%"} Title
          %th{:style => "width: 20%"} Author
          %th{:style => "width: 20%"} Status
        - @checkouts.each do |c|
          %tr.item{:id => "#{c['iid']}"}
            %td
              = check_box_tag ''
            %td
              =c['od']
            %td 
              = link_to "#{c['ou_title'].titleize || c['tl'].titleize}", "https://newcatalog.library.cornell.edu/catalog/#{c['bid']}"
            %td
              =c['au']
            %td
              =c['vstatus']
    = button_tag 'Renew', :type => 'button', :id => 'renew'
    = button_tag 'Export (RIS)', :type => 'button', :id => 'export-checkouts'
  %div#available-requests.tab-pane.fade{:role => "tabpanel"}
    No available requests
  %div#pending-requests.tab-pane.fade{:role => "tabpanel"}
    - if @pending_requests.length == 0 
      No pending requests
    - else
      %table#pending-requests-table
        %tbody
          %tr
            %th{:style => "width: 5%"}
              = check_box_tag 'select-all-requests', 1, nil, { :id => '', :class => 'select-all' }
            %th{:style => "width: 10%"} Request expires
            %th{:style => "width: 50%"} Title
            %th{:style => "width: 20%"} Author
            %th{:style => "width: 20%"} Type
          - @pending_requests.each do |c|
            %tr.item{:id => "#{c['iid']}"}
              %td
                = check_box_tag ''
              %td
                = c['NotWantedAfter'] || c['ed']
              %td
                = c['ou_title'] || c['tl']
              %td
                = c['ou_aulast'] || c['au']
              %td
                = request_types[c['ttype'] || c['system']]
      = button_tag 'Cancel request(s)', :type => 'button', :id => 'cancel'
      = button_tag 'Export (RIS)', :type => 'button', :id => 'export-requests'
  %div#fines.tab-pane.fade{:role => "tabpanel"}
    - if @fines.length == 0
      No fines or fees
    - else
      %table#fines-table
        %tbody
          %tr
            %th{:style => "width: 10%"} Incurred on
            %th{:style => "width: 50%"} Title
            %th{:style => "width: 20%"} Fine type
            %th{:style => "width: 20%"} Amount
          - @fines.each do |f|
            %tr
              %td
                = f['fineDate'][0]
              %td
                = f['itemTitle'][0]
              %td
                = f['fineType'][0]
              %td
                = f['amount'][0].gsub('USD ', '$')
    %br
    = link_to "View fine rates", "https://www.library.cornell.edu/services/borrow/fines"
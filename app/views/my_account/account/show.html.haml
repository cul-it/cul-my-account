= javascript_include_tag 'application'
= javascript_include_tag 'my_account/account'

- request_types = {'H' => 'Hold', 'R' => 'Recall', 'illiad' => 'Illiad', 'bd' => 'Borrow Direct'}
%h3 
  Account information for 
  = "#{@patron['first_name']} #{@patron['last_name']}"

%ul.nav.nav-tabs{:role => "tablist"}
  %li.active{:role => "presentation"}
    = link_to "Checked out (#{@checkouts.count})", "#checkouts", :class => "nav-link active", :data => { :toggle => "tab" }, :role => "tab", :aria => { :controls => "checkouts" }
  %li{:role => "presentation"}
    = link_to "Available requests (#{@available_requests.count})", "#available-requests", :class => "nav-link active", :data => { :toggle => "tab" }, :role => "tab", :aria => { :controls => "available requests" }
  %li{:role => "presentation"}
    = link_to "Pending requests (#{@pending_requests.count})", "#pending-requests", :class => "nav-link active", :data => { :toggle => "tab" }, :role => "tab", :aria => { :controls => "pending requests" }
  %li{:role => "presentation"}
    = link_to "Fines and fees (#{@fines.count})", "#fines", :class => "nav-link active", :data => { :toggle => "tab" }, :role => "tab", :aria => { :controls => "fines and fees" }

%div.tab-content
  %div#checkouts.tab-pane.fade.in.active{:role => "tabpanel"}
    %table#myaccount-table.table.table-striped.table-responsive
      %thead
        %tr
          %th{:scope => 'col', :class => 'myacct-col-5'}
            = check_box_tag 'select-all-checkouts', 1, nil, { :id => '', :class => 'select-all' }
            %span.sr-only
              Select all
          %th{:scope => 'col', :class => 'myacct-col-10'} Due date
          %th{:scope => 'col', :class => 'myacct-col-50'} Title
          %th{:scope => 'col', :class => 'myacct-col-20'} Author
          %th{:scope => 'col', :class => 'myacct-col-20'} Status
      %tbody
        - @checkouts.each do |c|
          %tr.item{:id => "#{c['iid']}"}
            %td
              = check_box_tag ''
            %td
              =c['od']
            %td 
              = link_to "#{c['ou_title'] || c['tl']}", "https://newcatalog.library.cornell.edu/catalog/#{c['bid']}"
            %td
              =c['au']
            %td
              =c['vstatus']
    = button_tag 'Renew', :type => 'button', :id => 'renew', :class => 'btn btn-danger'
    = button_tag 'Export (RIS)', :type => 'button', :id => 'export-checkouts', :class => 'btn btn-danger'
  %div#available-requests.tab-pane.fade{:role => "tabpanel"}
    No available requests
  %div#pending-requests.tab-pane.fade{:role => "tabpanel"}
    - if @pending_requests.length == 0 
      No pending requests
    - else
      %table#pending-requests-table.table.table-striped.table-responsive
        %thead
          %tr
            %th{:scope => 'col', :class => 'myacct-col-5'}
              = check_box_tag 'select-all-requests', 1, nil, { :id => '', :class => 'select-all' }
            %th{:scope => 'col', :class => 'myacct-col-10'} Request expires
            %th{:scope => 'col', :class => 'myacct-col-50'} Title
            %th{:scope => 'col', :class => 'myacct-col-20'} Author
            %th{:scope => 'col', :class => 'myacct-col-20'} Type
        %tbody
          - @pending_requests.each do |c|
            %tr.item{:id => "#{c['iid']}"}
              %td
                = check_box_tag ''
              %td
                = c['NotWantedAfter'] || c['ed']
              %td
                = c['ou_title'] || c['tl']
              %td
                = c['ou_aulast'] || c['au']
              %td
                = request_types[c['ttype'] || c['system']]
      = button_tag 'Cancel request(s)', :type => 'button', :id => 'cancel', :class => 'btn btn-danger'
      = button_tag 'Export (RIS)', :type => 'button', :id => 'export-requests', :class => 'btn btn-danger'
  %div#fines.tab-pane.fade{:role => "tabpanel"}
    - if @fines.length == 0
      %p
        No fines or fees
    - else
      %table#pending-requests-table.table.table-striped.table-responsive
        %thead
          %tr
            %th{:scope => 'col', :class => 'myacct-col-10'} Incurred on
            %th{:scope => 'col', :class => 'myacct-col-50'} Title
            %th{:scope => 'col', :class => 'myacct-col-20'} Type
            %th{:scope => 'col', :class => 'myacct-col-20'} Amount
        %tbody
          - @fines.each do |f|
            %tr
              %td
                = f['fineDate'][0]
              %td
                = f['itemTitle'][0]
              %td
                = f['fineType'][0]
              %td
                = f['amount'][0].gsub('USD ', '$')
    %p
    = link_to "View fine rates", "https://www.library.cornell.edu/services/borrow/fines"